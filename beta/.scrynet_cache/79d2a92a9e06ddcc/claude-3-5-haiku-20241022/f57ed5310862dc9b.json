{
  "stage": "annotation",
  "file": "WebGoat/src/main/java/org/owasp/webgoat/webwolf/MvcConfiguration.java",
  "prompt": "You are a secure coding expert providing feedback in a code review. Your task is to create an annotated code snippet for a specific security finding.\n\nSECURITY FINDING:\n- File: WebGoat/src/main/java/org/owasp/webgoat/webwolf/MvcConfiguration.java\n- Line: 18\n- Description: Unrestricted File Resource Handler Potential Path Traversal\n- Recommendation: Validate and sanitize the 'fileLocation' parameter to prevent potential directory traversal attacks. Implement strict path validation and ensure the configured directory is within a controlled, safe location.\n\nFULL CODE CONTENT:\n/*\n * SPDX-FileCopyrightText: Copyright \u00a9 2017 WebGoat authors\n * SPDX-License-Identifier: GPL-2.0-or-later\n */\npackage org.owasp.webgoat.webwolf;\n\nimport jakarta.annotation.PostConstruct;\nimport java.io.File;\nimport org.owasp.webgoat.container.UserInterceptor;\nimport org.springframework.beans.factory.annotation.Value;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.web.servlet.config.annotation.InterceptorRegistry;\nimport org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;\nimport org.springframework.web.servlet.config.annotation.ViewControllerRegistry;\nimport org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n@Configuration\npublic class MvcConfiguration implements WebMvcConfigurer {\n\n  @Value(\"${webwolf.fileserver.location}\")\n  private String fileLocation;\n\n  @Override\n  public void addResourceHandlers(ResourceHandlerRegistry registry) {\n    registry.addResourceHandler(\"/files/**\").addResourceLocations(\"file:///\" + fileLocation + \"/\");\n\n    registry.addResourceHandler(\"/css/**\").addResourceLocations(\"classpath:/webwolf/static/css/\");\n    registry.addResourceHandler(\"/js/**\").addResourceLocations(\"classpath:/webwolf/static/js/\");\n    registry\n        .addResourceHandler(\"/images/**\")\n        .addResourceLocations(\"classpath:/webwolf/static/images/\");\n  }\n\n  @Override\n  public void addViewControllers(ViewControllerRegistry registry) {\n    registry.addViewController(\"/login\").setViewName(\"webwolf-login\");\n    registry.addViewController(\"/home\").setViewName(\"home\");\n    registry.addViewController(\"/\").setViewName(\"home\");\n  }\n\n  @Override\n  public void addInterceptors(InterceptorRegistry registry) {\n    registry.addInterceptor(new UserInterceptor());\n  }\n\n  @PostConstruct\n  public void createDirectory() {\n    File file = new File(fileLocation);\n    if (!file.exists()) {\n      file.mkdirs();\n    }\n  }\n}\n\n\nINSTRUCTIONS:\n1.  Extract a code snippet of 10-15 lines centered around the vulnerable line (18).\n2.  Add a comment directly above the vulnerable line: `// FLAW: [Brief summary of the flaw]`\n3.  Add a comment block directly below the vulnerable line showing the corrected code: `// FIX: \n// [Corrected code line(s)]`\n\nProvide your response in a single, clean JSON object with one key, \"annotated_snippet\". Do not include any text outside the JSON.\nExample format:\n{\n  \"annotated_snippet\": \"public void insecureMethod(String userInput) {\\n    // ... some code ...\\n    // FLAW: This line is vulnerable to SQL Injection.\\n    Statement stmt = conn.createStatement();\\n    ResultSet rs = stmt.executeQuery(\\\"SELECT * FROM users WHERE name = '\" + userInput + \"'\\\");\\n    // FIX:\\n    // PreparedStatement ps = conn.prepareStatement(\\\"SELECT * FROM users WHERE name = ?\\\");\\n    // ps.setString(1, userInput);\\n    // ResultSet rs = ps.executeQuery();\\n    // ... more code ...\\n}\"\n}",
  "raw_response": "{\n  \"annotated_snippet\": \"@Configuration\\npublic class MvcConfiguration implements WebMvcConfigurer {\\n\\n  @Value(\\\"${webwolf.fileserver.location}\\\")\\n  private String fileLocation;\\n\\n  @Override\\n  public void addResourceHandlers(ResourceHandlerRegistry registry) {\\n    // FLAW: Unrestricted file resource handler enabling potential path traversal\\n    registry.addResourceHandler(\\\"/files/**\\\").addResourceLocations(\\\"file:///\\\" + fileLocation + \\\"/\\\");\\n    // FIX:\\n    // Validate fileLocation to ensure it's within a controlled, safe directory\\n    // Use FilenameUtils.normalize() or similar to sanitize the path\\n    // Implement strict validation to prevent directory traversal attacks\\n    // registry.addResourceHandler(\\\"/files/**\\\").addResourceLocations(\\\"file:///\\\" + sanitizePath(fileLocation) + \\\"/\\\");\\n\\n    registry.addResourceHandler(\\\"/css/**\\\").addResourceLocations(\\\"classpath:/webwolf/static/css/\\\");\\n    // ... other resource handlers ...\\n  }\"\n}\n```",
  "parsed": {
    "annotated_snippet": "@Configuration\npublic class MvcConfiguration implements WebMvcConfigurer {\n\n  @Value(\"${webwolf.fileserver.location}\")\n  private String fileLocation;\n\n  @Override\n  public void addResourceHandlers(ResourceHandlerRegistry registry) {\n    // FLAW: Unrestricted file resource handler enabling potential path traversal\n    registry.addResourceHandler(\"/files/**\").addResourceLocations(\"file:///\" + fileLocation + \"/\");\n    // FIX:\n    // Validate fileLocation to ensure it's within a controlled, safe directory\n    // Use FilenameUtils.normalize() or similar to sanitize the path\n    // Implement strict validation to prevent directory traversal attacks\n    // registry.addResourceHandler(\"/files/**\").addResourceLocations(\"file:///\" + sanitizePath(fileLocation) + \"/\");\n\n    registry.addResourceHandler(\"/css/**\").addResourceLocations(\"classpath:/webwolf/static/css/\");\n    // ... other resource handlers ...\n  }"
  },
  "timestamp": "2025-11-16T02:25:59.221794+00:00"
}